### 101. Key Considerations and Challenges

When implementing IBC on Cardano, several technical considerations and challenges must be addressed to ensure the solution’s robustness, security, and scalability. The nature of Cardano’s consensus model and its interaction with Cosmos' instant finality model requires special attention. Below are the key challenges and the strategies applied to mitigate them.

### Table of Contents
  - [Finality Handling](#1-finality-handling)
  - [Fee Optimization](#2-fee-optimization)
  - [Security and Scalability](#3-security-and-scalability)
  - [Rollback Handling on Cardano](#4-rollback-handling-on-cardano)
  - [Block Lag on Mithril Protocol](#5-block-lag-on-mithril-protocol)
  - [Impact on Usage and Transaction Flow](#impact-on-usage-and-transaction-flow)
  - [Summary of Key Challenges](#summary-of-key-challenges)

#### 1. Finality Handling

**Challenge**:  
Cardano’s proof-of-stake (PoS) consensus mechanism, **Ouroboros**, operates with probabilistic finality, meaning that transactions are considered final only after a certain number of blocks (epochs) have passed, whereas Cosmos-based chains typically use a BFT (Byzantine Fault Tolerant) model with near-instant finality. This discrepancy creates challenges when synchronizing transaction verification between the two networks.

**Solution**:  
To handle this, the **Mithril Protocol** plays a critical role in aggregating cryptographic proofs that provide a verifiable snapshot of Cardano’s state at a specific point in time. This snapshot is used to satisfy the finality requirements of Cosmos-based chains. While Cosmos Light Clients expect instant finality, the Mithril proof provides sufficient certainty regarding the state of the Cardano chain, even when full finality has not been reached in Cardano’s consensus model.

- **Delayed Confirmation**: Relayers may delay transaction finalization on Cosmos until enough blocks have passed on Cardano to achieve probabilistic finality.
- **Snapshot Verification**: The Mithril Protocol ensures that only valid, aggregated signatures from trusted SPOs are used for generating transaction proofs, improving confidence in cross-chain transactions.

#### 2. Fee Optimization

**Challenge**:  
Cross-chain operations require multiple transaction steps, including proof aggregation by the **Mithril Protocol**, submission by relayers, and finalization on the target chain. This multi-step process can result in higher transaction costs, especially on networks where transaction fees are based on computational complexity, such as Cardano.

**Solution**:  
Fee optimization involves several strategies to ensure that cross-chain transactions remain economically feasible:

- **Relayer Fee Efficiency**: The architecture allows relayers to batch transactions or handle multiple proof submissions simultaneously, which can help reduce overhead costs.
- **Mithril Proofs**: By using aggregated signatures from SPOs, the Mithril Protocol reduces the computational burden of creating transaction proofs, resulting in lower fees for Cardano-side operations.
- **Adaptive Gas Models**: The system may integrate adaptive fee models that dynamically adjust gas fees based on network congestion and the size of the proof, ensuring cost-efficiency.

#### 3. Security and Scalability

**Challenge**:  
Maintaining the security of cross-chain transactions between Cardano and Cosmos requires a robust mechanism for verifying the integrity of transactions and their proofs. Additionally, the system must scale to accommodate increasing transaction volume and the potential addition of more connected blockchains.

**Solution**:  
Security and scalability are addressed by multiple components in the architecture:

- **Mithril Protocol’s Aggregated Proofs**: Mithril enhances security by relying on multiple SPOs to sign off on a transaction snapshot, making it nearly impossible for a single malicious entity to compromise the system. The use of aggregated signatures ensures that only valid states are passed between chains, mitigating the risk of fraud or manipulation.
- **Threshold Signatures**: On the Cosmos side, threshold signatures ensure that a minimum quorum of validators must agree on any cross-chain transaction before it can be processed. This enhances trust in the system.
- **Decentralized Relayers**: The use of multiple, decentralized relayers eliminates single points of failure and allows the system to scale horizontally. As transaction volumes increase, additional relayers can participate to maintain throughput.
- **Modular IBC Architecture**: The modular nature of IBC allows the architecture to scale easily by connecting additional blockchains without major modifications to the core components.

#### 4. Rollback Handling on Cardano

**Challenge**:  
Due to Cardano’s probabilistic finality, rollbacks can occur within the chain if a transaction is not included in a finalized block. Rollbacks can lead to inconsistencies in the state when dealing with cross-chain transactions, especially if the transaction was already processed on the counterpart chain (Cosmos).

**Solution**:  
Handling rollbacks requires specific mechanisms to ensure that no inconsistencies arise between the connected chains:

- **Mithril Protocol Snapshots**: By aggregating the state via the Mithril Protocol and ensuring that only finalized snapshots are sent to Cosmos, we reduce the risk of rollbacks being misinterpreted as final transactions. The Mithril proofs reflect the state at a specific point in time, after which any rollback on Cardano would not affect Cosmos' transaction verification.
- **Reconciliation via Relayers**: In the event of a rollback, the relayer will not submit the transaction proof until it has passed a sufficient number of confirmations on Cardano. This ensures that no premature proofs are used to finalize transactions on the Cosmos side.
- **Retry Mechanism**: If a rollback invalidates a previously submitted proof, the relayer can retry the transaction submission with an updated proof generated after the rollback has been resolved. This mechanism ensures that transactions remain consistent across both chains.
- **Timeouts and Escrow**: Transactions may include timeout parameters or escrow conditions, ensuring that if a rollback occurs and the transaction isn't finalized in time, it can be safely canceled or retried without causing inconsistencies.

#### 5. Block Lag on Mithril Protocol

**Challenge**:  
Currently, on the Mithril mainnet, there is a **block lag of 120 blocks** before a transaction proof can be generated through the Mithril Protocol. This lag results in delays when obtaining the proof required for cross-chain transaction verification. In practical cross-chain communication scenarios, such a significant delay can hinder the efficiency of transactions between Cardano and Cosmos, especially when fast finality and quick transaction turnaround are desired.

The current block lag means that there could be a long waiting period between when a transaction is submitted on Cardano and when a verifiable proof is available to the Cosmos chain. This makes the process less practical for real-time applications, such as decentralized finance (DeFi) or decentralized exchanges (DEXs), where low latency is crucial.

**Solution (Current and Future)**:  
- **Current Approach**:  
  Currently, users and relayers must accept this delay while Mithril is further optimized. The block lag of 120 blocks ensures that the snapshot provided by Mithril is highly reliable, but it limits the usability of the system for time-sensitive applications. Until improvements are made, users may experience slower cross-chain transaction processing.

- **Future Optimizations**:  
  The Mithril team expects to **reduce this block lag to 0** in future releases. The goal is to generate **snapshots every 20 blocks**, which would significantly improve the speed at which proofs are created and reduce the time relayers wait to obtain valid transaction proofs. By aligning the snapshot frequency with this interval, the system can achieve more practical usage in real-world applications.

  - **Block Lag Reduction**: As the protocol evolves, the block lag is expected to decrease gradually. Once the lag is reduced to 0, Mithril will produce transaction proofs with minimal delay, making it suitable for more practical use cases in fast-moving blockchain ecosystems.
  - **20 Block Snapshot Intervals**: Generating snapshots every 20 blocks will align better with practical cross-chain needs, making Cardano’s integration with Cosmos via IBC faster and more competitive with other fast-finality networks. This interval would provide an optimal balance between proof reliability and transaction speed, ensuring that security is maintained without sacrificing usability.

#### Impact on Usage and Transaction Flow

- **Current Impact**:  
  The current 120-block lag limits the applicability of the Mithril Protocol in scenarios that require rapid cross-chain finality. Applications requiring near-real-time transactions may need to wait for the future optimizations to be rolled out before they can fully leverage the Cardano-Cosmos interoperability.

- **Future Expectations**:  
  Once the block lag is reduced to 0 and Mithril can produce snapshots every 20 blocks, the solution will be highly suitable for a broad range of applications, including those with stringent time constraints such as **DeFi protocols, DEXs, and NFT transfers**. This will make cross-chain operations between Cardano and Cosmos much more efficient and competitive, enhancing the overall utility of IBC on Cardano.

### Summary of Key Challenges

- **Finality Handling**: Cardano’s probabilistic finality is handled via Mithril Protocol’s aggregated proofs, which provide Cosmos with a reliable snapshot of Cardano’s state.
- **Fee Optimization**: Efficient relayer operations, optimized proof aggregation via Mithril, and dynamic fee models help keep transaction costs low.
- **Security and Scalability**: Mithril’s signature aggregation, threshold signatures on Cosmos, and decentralized relayers ensure secure and scalable cross-chain communication.
- **Rollback Handling**: Mithril Protocol’s snapshot mechanism and relayer retry logic ensure that rollbacks on Cardano are managed without introducing inconsistencies between the chains.
- **Current State**: The 120-block lag in the Mithril Protocol leads to significant delays in generating transaction proofs, making it less suitable for time-sensitive cross-chain operations.
- **Future Optimizations**: Expectation to reduce block lag to 0, with snapshots generated every 20 blocks, drastically improving transaction proof generation speed and making the system more practical for real-time cross-chain applications.

This adjustment will transform the Cardano IBC implementation into a highly efficient system that can support fast, secure, and scalable cross-chain operations, aligning with the needs of modern blockchain ecosystems.