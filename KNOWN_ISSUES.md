# Known Issues, Assymetries, and Architectural Considerations

## Denom Trace Mapping Implementation Asymmetry

The IBC denom trace mapping feature exhibits an implementation asymmetry between account-based chains (Cosmos SDK) and UTXO-based chains (Cardano). In Cosmos SDK's reference implementation (ibc-go), denom traces are stored directly in the chain's KVStore as part of the transfer module's keeper, making them consensus-critical blockchain state accessible via standard query endpoints, whereas Cardano's UTXO model lacks a native equivalent to Cosmos's stateful modules with persistent key-value storage. As a result, while voucher tokens on Cardano embed the denom trace information as a hash in their token names (maintaining cryptographic integrity), the reverse lookup mapping—from hash back to the full path and base denomination—must be maintained separately in the Gateway's off-chain PostgreSQL database (or another agreed upon off-chain solution) rather than on-chain. This architectural difference does not compromise security or correctness, as the hash-based token naming ensures voucher authenticity, but it does create an implementation incongruency where denom trace queries rely on off-chain indexing infrastructure rather than direct chain state queries.

While it is technically possible to store denom trace mappings on-chain within UTXO datums, that approach introduces challenges that make it suboptimal compared to off-chain indexing. Each UTXO on Cardano requires a minimum ADA deposit proportional to its size, meaning a growing mapping table would lock increasing amounts of capital as more cross-chain tokens are bridged. Additionally, Cardano's UTXO model lacks native indexed key-value lookups—querying a specific denom trace would require either scanning multiple UTXOs or maintaining a complex reference system, neither of which matches the instant lookup performance of Cosmos's KVStore. Furthermore, updating the mapping would require consuming and recreating UTXOs with validator logic, adding transaction costs and complexity for what is essentially read-heavy reference data. Since denom traces are derivable from transaction history and do not affect the security of token transfers (the on-chain voucher hashes remain authoritative), the cost-benefit analysis strongly favors off-chain indexing over on-chain UTXO storage.

Importantly, the off-chain denom trace database is fully reconstructible from on-chain data, as voucher minting transactions contain all necessary information to derive the hash-to-trace mappings. In scenarios where multiple bridge operators maintain separate infrastructure with independent databases, each operator would derive identical denom trace mappings because the hash computation is deterministic (based on the voucher token name observed on-chain). Similarly, if a bridge's database is lost, corrupted, or deleted, it can be rebuilt by scanning historical Cardano transactions for voucher minting events and extracting the packet data that contains the full denom path. While temporary database unavailability would interrupt query service for denom trace lookups, it would not affect the correctness or security of token transfers themselves, as the authoritative source of truth remains the on-chain voucher token hashes. Bridge operators might implement backup strategies, or providing synchronization mechanisms to ensure query availability and reduce redundant indexing work across multiple deployments.
